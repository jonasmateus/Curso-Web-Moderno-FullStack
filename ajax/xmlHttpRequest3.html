<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <title>XMLHttpRequest #03</title>
    <link rel='stylesheet' href='css/estilo.css'>
</head>

<body class="conteudo exercicio">
    <h1>Estados</h1>

    <script>
        function requisicaoAjax(config) {
            const xhr = new XMLHttpRequest()

            xhr.open(config.metodo, config.url)

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    xhr.status === 200 ? config.sucesso(xhr.response) : 
                    config.erro({tipo: xhr.status, texto: xhr.statusText})
                }
                
            }

            xhr.send()
        }

        let config = {
            url: "http://localhost:8080/dados/estados.json",
            metodo: "GET",

            sucesso (resposta) {
                
                const estados = Array.from(JSON.parse(resposta))
                
                function criarTabela(estados) {

                    const ul = document.createElement("ul")
                    let li = estados.map(estado => document.createElement("li"))

                    for (let i = 0; i < estados.length; i++){
                        li[i].innerHTML = estados[i].nome
                    }

                    li.forEach(i => ul.append(i))
                
                    document.querySelector("h1").append(ul)
                
                }

                 criarTabela(estados)

            },

            erro (erro) {
                console.log(erro.tipo, erro.texto)
            }
        }

        requisicaoAjax(config)
    </script>
</body>